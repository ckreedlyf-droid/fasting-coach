<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fasting Coach</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="icon" href="data:," />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html,body,#root{height:100%}</style>
</head>
<body class="bg-slate-950 text-slate-100">
  <div id="root"></div>

  <!-- React + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;
    const pad = n => String(n).padStart(2,"0");
    const HOUR = 60*60*1000, DAY_MS = 24*HOUR;
    const formatDuration = ms => {
      if(ms<0)ms=0;
      const s=Math.floor(ms/1000),h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;
      return `${pad(h)}:${pad(m)}:${pad(sec)}`;
    };
    const hoursFloat = ms => Math.max(0, ms/HOUR);

    const BENEFITS = {
      12:{title:"Glycogen Taper",desc:"Body begins relying less on glycogen; mild fat burning rises."},
      13:{title:"Hunger Wave #1",desc:"First ghrelin peak; distraction helps (walk, work, hydrate)."},
      16:{title:"Autophagy (Early)",desc:"Cellular cleanup begins; insulin remains low."},
      18:{title:"Ketone Rise",desc:"Fat mobilization; steady energy and focus."},
      24:{title:"24-Hour Reset",desc:"Deeper fat use; appetite hormones recalibrate."},
      36:{title:"Deeper Autophagy",desc:"Cellular recycling intensifies."},
      48:{title:"Inflammation ↓",desc:"Some report reduced inflammation markers."},
      72:{title:"3-Day Mark",desc:"Advanced fast. Break gently."}
    };
    const TIPS = [
      {range:[0,12],tips:["Hydrate early.","Plan to stay busy.","Black coffee/tea ok."]},
      {range:[12,18],tips:["Light movement helps.","Deep work session.","Add salt if light-headed."]},
      {range:[18,24],tips:["Workout distracts hunger.","Warm tea calms cravings.","Prep break-fast meal."]},
      {range:[24,36],tips:["Sleep early.","Stay hydrated with electrolytes.","Avoid new intense exercise."]},
      {range:[36,999],tips:["Consider medical advice.","Break gently with protein.","Stop if unwell."]}
    ];

    const LS = {
      start:"fasting.start",
      logs:"fasting.logs",
      target:"fasting.target"
    };

    function read(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}
    function write(k,v){localStorage.setItem(k,JSON.stringify(v))}

    function Progress({value,target}){
      const pct=Math.min(100,(value/target)*100);
      const size=140,stroke=10,r=(size-stroke)/2,c=2*Math.PI*r,dash=(pct/100)*c;
      return (
        <svg width={size} height={size}>
          <circle cx={size/2} cy={size/2} r={r} strokeWidth={stroke} strokeOpacity={0.15} stroke="currentColor" fill="none"/>
          <circle cx={size/2} cy={size/2} r={r} strokeWidth={stroke} strokeLinecap="round" stroke="currentColor"
            fill="none" strokeDasharray={`${dash} ${c-dash}`} transform={`rotate(-90 ${size/2} ${size/2})`}/>
          <text x="50%" y="50%" textAnchor="middle" dominantBaseline="middle" className="text-xl font-bold">{Math.floor(value)}h</text>
          <text x="50%" y="64%" textAnchor="middle" dominantBaseline="middle" className="text-xs opacity-70">target {target}h</text>
        </svg>
      );
    }

    function App(){
      const [now,setNow]=useState(Date.now());
      const [start,setStart]=useState(read(LS.start,null));
      const [logs,setLogs]=useState(read(LS.logs,[]));
      const [target,setTarget]=useState(read(LS.target,16));
      const [manual,setManual]=useState("");

      useEffect(()=>{const id=setInterval(()=>setNow(Date.now()),1000);return()=>clearInterval(id)},[]);
      useEffect(()=>write(LS.start,start),[start]);
      useEffect(()=>write(LS.logs,logs),[logs]);
      useEffect(()=>write(LS.target,target),[target]);

      const elapsed=start?now-start:0, hrs=hoursFloat(elapsed);
      const benefitReached=Object.keys(BENEFITS).map(Number).filter(h=>h<=hrs);
      const nextHour=Object.keys(BENEFITS).map(Number).find(h=>h>hrs);

      const phase=TIPS.find(t=>hrs>=t.range[0]&&hrs<t.range[1])||TIPS[TIPS.length-1];

      const endFast=()=>{
        if(!start)return;
        const entry={start,end:Date.now()};
        setLogs([entry,...logs]); setStart(null);
      };

      return (
      <div className="min-h-screen p-6 flex justify-center">
        <div className="max-w-5xl w-full grid md:grid-cols-3 gap-6">
          <section className="md:col-span-2 bg-slate-900 rounded-2xl p-6 border border-slate-800">
            <header className="flex justify-between mb-4"><h1 className="text-2xl font-bold">Fasting Coach</h1>
              <div className="text-sm opacity-70">Asia/Manila</div></header>
            <div className="flex flex-col md:flex-row gap-6 items-center">
              <Progress value={Math.min(hrs,target)} target={target}/>
              <div className="flex-1">
                <div className="text-5xl font-extrabold">{formatDuration(elapsed)}</div>
                <div className="text-sm opacity-80">Elapsed since last meal</div>
                <div className="mt-4 grid sm:grid-cols-2 gap-2">
                  <button onClick={()=>setStart(Date.now())} className="bg-emerald-500 rounded-xl py-2 font-semibold">Start Now</button>
                  <div className="flex gap-2">
                    <input type="datetime-local" value={manual} onChange={e=>setManual(e.target.value)}
                      className="w-full bg-slate-800 rounded-xl px-2"/>
                    <button onClick={()=>{const t=new Date(manual).getTime();if(!isNaN(t))setStart(t);}}
                      className="bg-slate-700 px-3 rounded-xl">Set</button>
                  </div>
                  <button onClick={endFast} className="bg-sky-500 rounded-xl py-2 font-semibold">End & Log</button>
                  <div className="flex gap-2 items-center text-sm">
                    <label>Target (h)</label>
                    <input type="number" min="12" max="72" value={target} onChange={e=>setTarget(Number(e.target.value))}
                      className="w-20 bg-slate-800 rounded-xl px-2"/>
                  </div>
                </div>
              </div>
            </div>
            <div className="mt-6 grid md:grid-cols-2 gap-6">
              <div className="bg-slate-800/50 p-4 rounded-2xl">
                <h2 className="font-bold mb-2">Benefits Reached</h2>
                <ul className="text-sm space-y-1 max-h-48 overflow-auto">
                  {benefitReached.length?benefitReached.map(h=>
                    <li key={h}><span className="text-emerald-400">{h}h:</span> {BENEFITS[h].title}</li>)
                    :<li className="opacity-70">Keep going—first milestone at 12h.</li>}
                </ul>
              </div>
              <div className="bg-slate-800/50 p-4 rounded-2xl">
                <h2 className="font-bold mb-2">Next Up</h2>
                {nextHour?
                  <div className="text-sm"><span className="text-sky-400">{nextHour}h:</span> {BENEFITS[nextHour].title}</div>
                  :<div className="text-sm opacity-70">All milestones done!</div>}
                <h3 className="font-semibold mt-4 mb-1">Phase Tips</h3>
                <ul className="list-disc list-inside text-sm">{phase.tips.map((t,i)=><li key={i}>{t}</li>)}</ul>
              </div>
            </div>
          </section>

          <aside className="bg-slate-900 rounded-2xl p-6 border border-slate-800">
            <h2 className="font-bold mb-3">History</h2>
            {logs.length===0 && <div className="text-sm opacity-70">No logs yet.</div>}
            <ul className="space-y-2 max-h-72 overflow-auto text-sm">
              {logs.map((l,i)=>{
                const dur=hoursFloat(l.end-l.start).toFixed(1);
                return <li key={i} className="bg-slate-800/60 p-2 rounded-xl border border-slate-700">
                  {dur}h — {new Date(l.start).toLocaleString()}
                </li>;
              })}
            </ul>
          </aside>
        </div>
      </div>);
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
